{% extends 'topic.html' %}
{% block content %}
    {% load static %}
    <script src="{% static "english/js/sound.js?q=1" %}"></script>
    <script src="{% static "english/js/irregular.js?q=1" %}"></script>
    <div align="center"><b>{{ title }}</b></div>
    <style type="text/css">
        .paddingBetweenRows td
        {
            padding:0 5px 0 5px;
        }
        .content table
        {
        }
        .content td
        {
            vertical-align: middle;
            padding:0 0px 0 0px;
            color: black;

        }
        td.trn
        {
            vertical-align: middle;
            padding:0 10px 0 5px;
            color: grey;
        }
        td[irr]
        {
            display: inline;
        }
    </style>

    <table width="100%" cellpadding="0" cellspacing="0" class="paddingBetweenRows">
        <tr>
            <td><span>inf:</span><input type="checkbox" id="infid" checked onclick="repaint()"></td>
            <td><span>pas:</span><input type="checkbox" id="pasid" checked onclick="repaint()"></td>
            <td><span>prf:</span><input type="checkbox" id="prfid" checked onclick="repaint()"></td>
            <td><span>rus:</span><input type="checkbox" id="rusid" checked onclick="repaint()"></td>
            <td><span>loop:</span><input type="checkbox" id="loopid" checked onclick="repaint()"></td>
            <td><span>delay:&nbsp;</span><select id="delayid" onclick="repaint()">
                <option value="0">0 sec</option>
                <option value="1">1 sec</option>
                <option value="2">2 sec</option>
            </select>
            <td width="500px" style="display: inline-block">
                amount:
                <input id="50id" type="radio" name="length" checked onclick="recreate()">50
                <input id="100id" type="radio" name="length" onclick="recreate()">100
                <input id="150id" type="radio" name="length" onclick="recreate()">150
                group:
                <input id="group1id" type="radio" name="group" checked onclick="repaint()">10
                <input id="group2id" type="radio" name="group" onclick="repaint()">25
                <input id="group3id" type="radio" name="group" onclick="repaint()">50
            </td>
            </td>
            <td width="100%">
                <input id="modeid" type="button" checked onclick="save(this)" mode='view' value="Edit">
                <input id="saveid" type="button" checked onclick="save(this)" mode='save' value="Save">
            </td>
        </tr>
        <tr>
            <td id="navigateid" colspan="9" align="center"></td>
        </tr>
    </table>
    <div id="playAll"></div>
    <table id="table1" cellpadding="0" cellspacing="0" class='content'></table>

    <script>
        SettingsSingleton.getInstance().init('settings_irregular', createSettings);

        document.onreadystatechange = function () {
            if (document.readyState == "complete") {
                load('view');
            }
        }
        function save(self) {
            let mode = self.getAttribute('mode');
            let url = '/eng/irregular/{{ user_id }}/?dir=save';
            if (mode == 'save') {
                SettingsSingleton.getInstance().recreate();
                SettingsSingleton.getInstance().saveToServer(url, function () {});
            } else if (mode == 'edit') {
                self.setAttribute('mode', 'view')
                self.value = 'Edit'
                SettingsSingleton.getInstance().recreate();
                SettingsSingleton.getInstance().saveToServer(url, function () {
                    clearElement("table1");
                    clearElement("playAll");
                    load();
                });
            } else {
                self.setAttribute('mode', 'edit')
                self.value = 'View'
                clearElement("table1");
                clearElement("playAll");
                load();
            }
        }
        function load() {
                let meta_sound_url = "{{ meta_sound_url }}";
                let dic50_sound_url = "{{ i50_url }}";
                let dic100_sound_url = "{{ i100_url }}";
                let dic150_sound_url = "{{ i150_url }}";
                let startImgName = "{% static 'english/img/play-start.png' %}";
                let stopImgName = "{% static 'english/img/play-stop.png' %}";
                let settings_url = '/eng/irregular/{{ user_id }}/?dir=read';
                var urls = {
                    meta_sound_url: meta_sound_url,
                    i50_url: dic50_sound_url,
                    i100_url: dic100_sound_url,
                    i150_url: dic150_sound_url
                }
                SettingsSingleton.getInstance().readFromServer(settings_url, function (settings) {
                    settings.mode = document.getElementById('modeid').getAttribute('mode');
                    SettingsSingleton.getInstance().commit(settings);
                    initControls();
                    createPageNavigation("navigateid", repaint);
                    loadPage(urls, startImgName, stopImgName);
                })
        }

        function repaint() {
            SettingsSingleton.getInstance().recreate();
            createPageNavigation("navigateid", repaint);
            showContent()
        }

        function recreate() {
            SettingsSingleton.getInstance().recreate();
            clearElement("table1");
            clearElement("playAll");
            createPageNavigation("navigateid", repaint);
            createPage()
            showContent()
        }

        function createSettings() {
            let mode = document.getElementById('modeid').getAttribute('mode');
            let el = document.querySelector('input[name=page_navigation]:checked');
            let range_of_verbs_index = el == null ? 0 : parseInt(el.value);
            let settings = {
                id: 'settings_irregular',
                mode: mode,
                excludes: {},
                is_inf: document.getElementById('infid').checked,
                is_pas: document.getElementById('pasid').checked,
                is_prf: document.getElementById('prfid').checked,
                is_rus: document.getElementById('rusid').checked,
                total_of_verbs: document.getElementById('50id').checked
                        ? 50
                        : document.getElementById('100id').checked
                            ? 100
                            : document.getElementById('150id').checked
                                ? 150
                                : 50,
                range_of_verbs: document.getElementById('group1id').checked
                        ? 10
                        : document.getElementById('group2id').checked
                            ? 25
                            : document.getElementById('group3id').checked
                                ? 50
                                : 25,
                range_of_verbs_index: range_of_verbs_index,
                loop: document.getElementById("loopid").checked ? 100 : 0,
                delay: document.getElementById("delayid").selectedIndex
            }
            var els = document.querySelectorAll("input[identity]:checked");
            [].forEach.call(els, function(el) {
                let id = el.getAttribute('identity')
                settings.excludes[id] = 1
            });
            return settings;
        }

        function initControls() {
            let settings = SettingsSingleton.getInstance().get();
            document.getElementById('infid').checked = settings.is_inf;
            document.getElementById('pasid').checked = settings.is_pas;
            document.getElementById('prfid').checked = settings.is_prf;
            document.getElementById('rusid').checked = settings.is_rus;
            switch (settings.total_of_verbs) {
                case 50: document.getElementById('50id').checked = true; break;
                case 100: document.getElementById('100id').checked = true; break;
                case 150: document.getElementById('150id').checked = true; break;
            }
            switch (settings.range_of_verbs) {
                case 10: document.getElementById('group1id').checked = true; break;
                case 25: document.getElementById('group2id').checked = true; break;
                case 50: document.getElementById('group3id').checked = true; break;
            }
            document.getElementById("loopid").checked = settings.loop > 0;
            document.getElementById("delayid").selectedIndex = settings.delay;
        }
    </script>

{% endblock %}